<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Frank's Redily</title><link rel=stylesheet href=/css/bulma.min.css><link rel=stylesheet href=/css/style.css></head><body class=terminal><section class=window><header class=window-header><div class="logo terminal-prompt"><a href=https://franknvc.github.io/ class=no-style>Frank's Redily</a>
<span style=color:blue>:~#</span>
<a href=https://franknvc.github.io/posts>posts</a><span style=color:#1a95e0>/</span>
<a href=https://franknvc.github.io/posts/web-development>web-development</a><span style=color:#1a95e0>/</span>
<a href=https://franknvc.github.io/posts/web-development/best-practices-api>best-practices-api</a><span style=color:#1a95e0>/</span></div><div class=window-controls><span class="control-item control-minimize">‒</span>
<span class="control-item control-maximize">□</span>
<span class="control-item control-close">˟</span></div></header><main class=window-content id=content><div class=container><div class=window-cursor><span class=i-cursor-indicator>></span><div class=terminal-nav><nav class=terminal-menu><ul vocab="https://schema.org/" typeof="BreadcrumbList"><li><a href=/about typeof="ListItem">/about</a></li><li><a href=/posts typeof="ListItem">/posts</a></li><li><a href=/projects typeof="ListItem">/projects</a></li><li><a href=/gallery typeof="ListItem">/photos</a></li><li><a href=/resume typeof="ListItem">/resumé</a></li></ul></nav></div><span class=i-cursor-underscore></span></div><div class=scrollable><h1>[Web Dev] Best Practices for Designing APIs</h1>Apr. 18, 2021<br><br><p>REST APIs are one of the most common kinds of web services available today. Therefore developers have come up with best practices so that we do not commit errors when designing APIs. In this post, we are going to look at some of the best practices.</p><h2 id=json>JSON</h2><p>REST APIs should accept JSON for request payload and also send responses in JSON. You could say that JSON has become the standard for transfering data. There are of course, other ways to transfer data, for example, using XML. However, XML isn&rsquo;t widely supported by frameworks. It usually does not work right out of the box without transforming the data to something that can be used, and that&rsquo;s usually JSON.</p><h2 id=use-nouns-instead-of-verbs-in-endpoints>Use Nouns instead of Verbs in endpoints</h2><p>To make the APIs easier to be understood and consumed, you should use nouns to represent the entity that we&rsquo;re retrieving. The reason is that HTTP request already includes all the verbs. Having verbs in our API endpoint isn&rsquo;t useful and unnecessary. The action should be indicated by the HTTP request methods, such as <em>GET, POST, PUT, DELETE</em>. Given below is an example in which we are going to work with the enity <code>article</code> using APIs:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>express</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;express&#34;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bodyParse</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#34;body-parser&#34;</span>);

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>body</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>parser</span>.<span style=color:#a6e22e>json</span>());

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/articles&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>articles</span> <span style=color:#f92672>=</span> [];
  <span style=color:#75715e>// code to retrieve
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>(<span style=color:#a6e22e>articles</span>);
});

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/articles&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#75715e>// code to add new article
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>);
});

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;/articles/:id&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>id</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>params</span>;
  <span style=color:#75715e>// code to update an article
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>);
});

<span style=color:#a6e22e>app</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#e6db74>&#34;/articles/:id&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>id</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>params</span>;
  <span style=color:#75715e>// code to delete an article
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>({ <span style=color:#a6e22e>deleted</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>id</span> });
});

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#ae81ff>3000</span>, () =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;server started&#34;</span>));
</code></pre></div><h2 id=name-collections-with-plural-nouns>Name Collections with plural nouns</h2><p>Use plurals to name collections in order to be consistent with what&rsquo;s in the database (following the naming convention for database schema). Collections have more than one record, and their names should reflect that fact. For example, <code>/articles</code>, <code>/users</code>.</p><h2 id=nesting-resources>Nesting Resources</h2><p>The endpoints that deal with nested resources should be done by appending the nested resources to the parent resource. For example, <code>/articles/:articleId/comments</code>. We get <code>comments</code> on the article retrieved by <code>articleId</code>.</p><h2 id=handle-errors-and-return-standard-error-codes>Handle Errors and Return Standard Error Codes</h2><p>We handle the error so when error occurs, it will not bring the system down. And in order to eliminate confusion for API consumer we should handle the error properly and return in response standard error codes along with meaningful messages.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> [{ <span style=color:#a6e22e>email</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;foo@abc.com&#34;</span> }];

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/users&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>email</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userExists</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>find</span>((<span style=color:#a6e22e>u</span>) =&gt; <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>email</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>email</span>);
  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>userExists</span>) {
    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>400</span>).<span style=color:#a6e22e>json</span>({ <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;User already exists&#34;</span> });
  }
  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>);
});
</code></pre></div><p>Error codes need to have messages accompanied with them, as shown in the example, so that the maintainers have enough information to troubleshoot the issue.</p><h2 id=allow-filtering-and-pagination>Allow Filtering and Pagination</h2><p>The data retrieved by a request can get very large. To return all at once can be too slow or bring our system down. Therefore, we need ways to filter items.</p><p>We also need ways to paginate data so that we only return a few results at a time.</p><h2 id=security>Security</h2><p>Communication between client and server should be private and secure. Therefore, using SSL/TLS for security is a must.</p><p>People shouldn&rsquo;t be able to access information more than what they requested. We need to enforce security, by adding role checks, following the principle of the least privilege or to have a granular permissions for each feature that user has access to.</p><h2 id=cache-data>Cache Data</h2><p>If the data requested is accessed frequently but without modification, we can cache the data instead of querying the database to get the data every time. This result in faster performance whenever the data is needed.</p><p><code>Express</code> has the apicache middleware to add caching without much configuration. You can configure to cache a specific route, cache all routes, and you can indicate which storage can be used for caching, for example, using <code>Redis</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;express&#39;</span>
<span style=color:#66d9ef>import</span> <span style=color:#a6e22e>apicache</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;apicache&#39;</span>

<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>()
<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cache</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>apicache</span>.<span style=color:#a6e22e>middleware</span>

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/api/collection/:id?&#39;</span>, <span style=color:#a6e22e>cache</span>(<span style=color:#e6db74>&#39;5 minutes&#39;</span>), (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
  <span style=color:#75715e>// do some work... this will only occur once per 5 minutes
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>({ <span style=color:#a6e22e>foo</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;bar&#39;</span> })
})
</code></pre></div><h2 id=versioning-apis>Versioning APIs</h2><p>If you have different versions of your API, the versioning can be done with <code>/v1/</code>, <code>/v2/</code>, etc. added at the start of the API path.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/v1/employees&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {});

<span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/v2/employees&#34;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {});
</code></pre></div></div></div></main><footer class=bottom><small>Copyright 2021 Nguyen Viet Cuong</small></footer></section></body></html>